// ===============================
// BLACKONIX socket.js
// Handles Socket.IO connection
// ===============================

document.addEventListener("DOMContentLoaded", function () {

    // Connect to server
    const socket = io({
        transports: ["websocket"],
        upgrade: false
    });

    const username = document.body.getAttribute("data-username") || "Guest";

    // When connected
    socket.on("connect", function () {
        console.log("Connected to server");

        // Notify server user joined
        socket.emit("join", {
            user: username
        });
    });

    // When disconnected
    socket.on("disconnect", function () {
        console.log("Disconnected from server");
    });

    // Send message function (can be used globally)
    window.sendSocketMessage = function (messageText) {

        if (!messageText || messageText.trim() === "") return;

        const messageData = {
            user: username,
            message: messageText,
            time: new Date().toLocaleTimeString()
        };

        socket.emit("send_message", messageData);
    };

    // Receive message
    socket.on("receive_message", function (data) {
        if (typeof addMessage === "function") {
            addMessage(data, data.user === username ? "sent" : "received");
        }
    });

    // User joined
    socket.on("user_joined", function (data) {
        if (typeof addSystemMessage === "function") {
            addSystemMessage(data.user + " joined the chat");
        }
    });

    // User left
    socket.on("user_left", function (data) {
        if (typeof addSystemMessage === "function") {
            addSystemMessage(data.user + " left the chat");
        }
    });

});